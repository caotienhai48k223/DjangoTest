{% extends 'layouts/default.html' %}

{% block main %}

  {%for message in messages%}
  <div>{{message}}</div>
  {% endfor %}
  <div class="product-container row">
    <div class="col-6">
      {% for image in images %}
        <div class="col-3">
          <img src="{{image}}" width="100px" height="auto" alt="Ảnh Biến Thể">
        </div>
      {% endfor %}
    </div>
    <div class="col-6">
      <p>{{product.title}}</p>
      <p>{{product.price}}</p>
      <div class="hihi">
        <h5>Chọn Màu</h5>
        {% for color in colors %}
          <button select_color class="{% if forloop.first %}btn btn-outline-dark active{% else %}btn btn-outline-dark{% endif %}">{{color}}</button>
        {% endfor %}
        <input class="d-none" id="color-cart" value="">
      </div>
      <div class="huhu">
        <h5>Chọn Size</h5>
        {% for size in sizes%}
          <button select_size class="{% if forloop.first %}btn btn-outline-dark active{% else %}btn btn-outline-dark{%endif%}">{{size}}</button>
        {% endfor %}
        <input class="d-none" id="size-cart" value="">
      </div>
      <div>
        <input type="number" style="width: 100px;" class="form-control" id="qty-cart" value="1" min="1">
      </div>
      <button class="btn btn-success" value="{{product.id}}" id="add-cart">Add To Cart</button>
    </div>
  </div>


  <script>
    const buttonColors = document.querySelectorAll('[select_color]')
    const colorInput = document.querySelector('#color-cart')
    if (buttonColors.length > 0) {
      buttonColors.forEach((button) => {
        const classActive = button.getAttribute('class')
        if (classActive.includes('active')) {
          colorInput.value = button.textContent.trim()
        }
        button.addEventListener('click', () => {
          buttonColors.forEach((btn) => btn.classList.remove('active'));
          button.classList.add('active')
          colorInput.value = button.textContent.trim()
        })
      })
    }

    const buttonSizes = document.querySelectorAll('[select_size]')
    const sizeInput = document.querySelector('#size-cart')
    if (buttonSizes.length > 0) {
      buttonSizes.forEach((button) => {
        const classActive = button.getAttribute('class')
        if (classActive.includes('active')) {
          sizeInput.value = button.textContent.trim()
        }
        button.addEventListener('click', () => {
          buttonSizes.forEach((btn) => btn.classList.remove('active'));
          button.classList.add('active')
          sizeInput.value = button.textContent.trim()
        })
      })
    }




    $(document).on('click', '#add-cart', function(e){
      e.preventDefault();
      $.ajax({
        type:'POST',
        url:"{% url 'cart-add' %}",
        data: {
          product_id: $('#add-cart').val(),
          product_qty: $('#qty-cart').val(),
          product_color: $('#color-cart').val(),
          product_size: $('#size-cart').val(),
          csrfmiddlewaretoken: '{{csrf_token}}',
          action:'post'
        },
        success: function(json){          
          location.reload()
        },
        error: function(xhr, errmsg, err){

        }
      })
    })
  </script>
  
{% endblock %}